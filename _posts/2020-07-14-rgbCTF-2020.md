---
layout: post
title: rgbCTF 2020
---

## Má»Ÿ Ä‘áº§u

Cuá»‘i tuáº§n vá»«a rá»“i mÃ¬nh khÃ¡ lÃ  ráº£nh, tÃ­nh kiáº¿m gÃ¬ chÆ¡i nÃªn má»›i mÃ² vÃ o giáº£i CTF nÃ y, mÃ¬nh vÃ o pháº§n prizes thÃ¬ tháº¥y cÃ³ trao thÆ°á»Ÿng há»™p má»©t ğŸ“ ğŸ˜‹ nÃªn mÃ¬nh quyáº¿t Ä‘á»‹nh cáº¯m chuá»™t ğŸ€ vÃ o chÆ¡i thÃ´i.

VÃ¬ Ä‘Ã¢y lÃ  giáº£i CTF Ä‘áº§u tiÃªn mÃ¬nh chÆ¡i nÃªn rank cÅ©ng khÃ´ng Ä‘Æ°á»£c cao láº¯m vÃ  cÅ©ng cháº£ Ä‘Æ°á»£c há»™p má»©t nÃ o, khÃ¡ lÃ  buá»“n ğŸ˜¢

![](../ctf/rgbCTF/img/Screenshot_20200715_073454.png)


## Table of Contents
 + [**{BEGINER} Simple RSA**](#wu1)
 + [**{CRYPTO} e**](#wu2)
 + [**{CRYPTO} Occasionally Tested Protocol**](#wu3)
 + [**{MISC} Picking Up The Pieces**](#wu4)
 + [**{MISC} [another witty algo challenge name]**](#wu5)


<a name="wu1"></a>

## {BEGINER} Simple RSA

Äá» bÃ i ráº¥t Ä‘Æ¡n giáº£n, cho 2 files, 1 file `.py` chá»©a implementation cá»§a thuáº­t toÃ¡n RSA vÃ  file cÃ²n láº¡i chá»©a 3 sá»‘ `n`, `e`, `c`. ChÃºng ta pháº£i decode Ä‘oáº¡n cipher text `c` Ä‘á»ƒ láº¥y Ä‘Æ°á»£c plain text cÅ©ng chÃ­nh lÃ  flag ğŸ´.

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_074336.png)

Dá»… dÃ ng nháº­n tháº¥y `n` á»Ÿ Ä‘Ã¢y khÃ´ng quÃ¡ lá»›n (length < `256 bit`) nÃªn mÃ¬nh nghÄ© ngay Ä‘áº¿n viá»‡c phÃ¢n tÃ­ch `n` ngÆ°á»£c láº¡i thÃ nh `p` vÃ  `q`. Viá»‡c nÃ y dá»… dÃ ng thá»±c hiá»‡n Ä‘Æ°á»£c báº±ng cÃ¡c cÃ´ng cá»¥ online nhÆ° [factordb](http://factordb.com/) hay [alpertron](https://www.alpertron.com.ar/ECM.HTM).

![](../ctf/rgbCTF-2020/img/rsa.gif)

Sau khi tÃ¬m Ä‘Æ°á»£c `p` vÃ  `q`, mÃ¬nh rÃ¡p chÃºng vÃ o Ä‘oáº¡n python cho sáºµn, tÃ¬m Ä‘Æ°á»£c `d` .

```python
p = 255097177
q = 22034393943473183756163118460342519430053
n = p * q
e = 65537
lmbd = lcm(p - 1, q - 1)
d = mod_inverse(e, lmbd)
```

CÃ³ `c`, `d` vÃ  `n` rá»“i, viá»‡c cÃ²n láº¡i lÃ  tÃ¬m plain text á»Ÿ dáº¡ng sá»‘ báº±ng cÃ´ng thá»©c `m = c ^ d (mod n)`.

```python
c = 1415060907955076984980255543080831671725408472748
m = pow(c, d, n)
```

Tuy nhiÃªn plain text Ä‘ang á»Ÿ dáº¡ng sá»‘ nÃªn mÃ¬nh váº«n chá»© tháº¥y Ä‘Æ°á»£c chá»¯ gÃ¬ ğŸ˜µ, tiáº¿p theo lÃ  hÃ m chuyá»ƒn sá»‘ thÃ nh chá»¯ thÃ´i ğŸ˜.

```python
def int_to_bytes(x: int) -> bytes:
    return x.to_bytes((x.bit_length() + 7) // 8, 'little')
```

Táº¡i sao láº¡i lÃ  `(bitlength + 7) // 8`? VÃ¬ param Ä‘áº§u tiÃªn cá»§a hÃ m `int.to_bytes()` lÃ  Ä‘á»™ dÃ i cá»§a chuá»—i sau khi decrypt, 1 kÃ­ tá»± Ä‘Æ°á»£c biá»ƒu diá»…n báº±ng `8 bits`, mÃ  `00000001` cÅ©ng biá»ƒu diá»…n 1 kÃ­ tá»± nhÆ°ng Ä‘á»™ dÃ i bit láº¡i báº±ng 1 (nhá»¯ng bit 0 á»Ÿ Ä‘áº§u khÃ´ng cÃ³ nghÄ©a Ä‘á»u bá»‹ bá» Ä‘i). `1 // 8 == 0` => khÃ´ng cÃ³ kÃ­ tá»± nÃ o sau khi decrypt, váº­y lÃ  dá»Ÿ rá»“i ğŸ˜‚.

Äá»ƒ cho dá»… dá»… hiá»ƒu, báº¡n hÃ£y quan sÃ¡t bá»©c áº£nh dÆ°á»›i:

![](../ctf/rgbCTF-2020/img/cat.png)

NhÆ° báº¡n tháº¥y Ä‘áº¥y, con mÃ¨o nÃ y cháº³ng liÃªn quan gÃ¬ Ä‘áº¿n bÃ i toÃ¡n cáº£ :v. ThÃ´i nÃ o, bÃ¢y giá» mÃ¬nh quay láº¡i váº¥n Ä‘á» chÃ­nh.

MÃ¬nh cáº§n pháº£i cá»™ng thÃªm má»™t lÆ°á»£ng vá»«a Ä‘á»§ Ä‘á»ƒ khÃ´ng bá»‹ dÆ° cÅ©ng nhÆ° khÃ´ng bá»‹ thiáº¿u. ChÃ­nh lÃ  sá»‘ 7, vÃ¬ 7 chÃ­nh lÃ  sá»‘ lÆ°á»£ng bit 0 lÃºc nÃ£y bá»‹ bá» Ä‘i á»Ÿ Ä‘áº§u.

`(0 + 7) // 8 == 0` khi Ä‘á»™ dÃ i bit báº±ng 0 thÃ¬ dá»™ dÃ i báº±ng 0 (thá»a mÃ£n)
`(1 + 7) // 8 == 1` khi ------------- = 1 thÃ¬ --------- = 1 (váº«n thá»a mÃ£n)
`(8 + 7) // 8 == 1` khi ------------- = 8 thÃ¬ --------- = 1 (nhÆ° trÃªn)

b00m ğŸ’£, nguyÃªn liá»‡u Ä‘Ã£ xong, viá»‡c cÃ²n láº¡i lÃ  bá» háº¿t vÃ o vÃ  xÃ o náº¥u thÃ´i ğŸ¥—.

```python
from sympy import mod_inverse
from math import gcd

def int_to_bytes(x: int) -> bytes:
    return x.to_bytes((x.bit_length() + 7) // 8, 'little')

def lcm(a: int, b: int) -> int:
    return a * b // gcd(a, b)

p = 255097177
q = 22034393943473183756163118460342519430053
n = p * q
e = 65537
lmbd = lcm(p - 1, q - 1)
d = mod_inverse(e, lmbd)

c = 1415060907955076984980255543080831671725408472748
m = pow(c, d, n)
print(int_to_bytes(m))
```


<a name="wu2"></a>

## {CRYPTO} e

BÃ i nÃ y láº¡i lÃ  má»™t bÃ i vá» `RSA`, ngÆ°á»i ta cho ba sá»‘ `n`, `e` vÃ  `c`. MÃ¬nh cáº§n pháº£i decrypt `c` Ä‘á»ƒ tÃ¬m Ä‘Æ°á»£c flag ğŸ´.

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_093624.png)

MÃ¬nh quan sÃ¡t tháº¥y `e` khÃ¡ lÃ  nhá», `e = 13`.

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_091729.png)

Do e nhá», `c << n` mÃ  `c = m ^ e (mod n)` suy ra phÃ©p modulo khÃ´ng lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n `c` ban Ä‘áº§u. Do Ä‘Ã³ `m = c ^ (1/e)`.

![](../ctf/rgbCTF-2020/img/math.png)

Äá»ƒ tÃ­nh chÃ­nh xÃ¡c cÄƒn báº­c `e` cá»§a `c` thÃ¬ mÃ¬nh dÃ¹ng hÃ m `iroot()` trong thÆ° viá»‡n `gmpy2`.

```python
import gmpy2

def int_to_bytes(x: int) -> bytes:
    return x.to_bytes((x.bit_length() + 7) // 8, 'little')

e = 0b1101
c = 0x6003a15ff3f9bc74fcc48dc0f5fc59c31cb84df2424c9311d94cb40570eeaa78e0f8fc2917addd1afc8e5810b2e80a95019c88c4ee74849777eb9d0ee27ab80d3528c6f3f95a37d1581f9b3cd8976904c42f8613ee79cf8c94074ede9f034b61433f1fef835f2a0a45663ec4a0facedc068f6fa2b534c9c7a2f4789c699c2dcd952ed82180a6de00a51904c2df74eb73996845842276d5523c66800034351204b921d4780180ca646421c61033017e4986d9f6a892ed649c4fd40d4cf5b4faf0befb1e2098ee33b8bea461a8626dd8cd2eed05ccd471700e2a1b99ed347660cbd0f202212f6c0d7ad8ef6f878d887af0cd0429c417c9f7dd64890146b91152ea0c30637ce503635018fd2caf436a12378e5892992b8ec563f0988fc0cebd2926662d4604b8393fb2000

m, _ = gmpy2.iroot(c, e)
print(int_to_bytes(int(m)))
```


<a name="wu3"></a>

## {CRYPTO} Occasionally Tested Protocol

á» Ä‘Ã¢y, ngÆ°á»i ta encrypt flag ğŸ´ vá»›i má»™t chuá»—i `random`. Do Ä‘Ã³, má»—i láº§n káº¿t ná»‘i Ä‘áº¿n server mÃ¬nh sáº½ nháº­n Ä‘Æ°á»£c má»™t cipher text khÃ¡c nhau.

Báº£n cháº¥t cá»§a hÃ m `random` lÃ  nháº­n vÃ o má»™t giÃ¡ trá»‹, giÃ¡ trá»‹ Ä‘Ã³ Ä‘Æ°á»£c gá»i lÃ  `seed`. Sau Ä‘Ã³ hÃ m `random` báº¯t Ä‘áº§u sinh ra cÃ¡c sá»‘ ngáº«u nhiÃªn dá»±a trÃªn giÃ¡ trá»‹ cá»§a `seed`. Váº­y náº¿u `seed` giá»‘ng nhau thÃ¬ cÃ¡c sá»‘ ngáº«u nhiÃªn Ä‘Æ°á»£c sinh ra bá»Ÿi hÃ m `random` lÃ  giá»‘ng nhau.

MÃ¬nh lÆ°á»›t sÆ¡ qua thÃ¬ nháº­n tháº¥y `seed` á»Ÿ Ä‘Ã¢y Ä‘Æ°á»£c láº¥y tá»« hÃ m `time()` tá»©c lÃ  láº¥y thá»i gian lÃºc Ä‘oáº¡n code Ä‘Æ°á»£c thá»±c thi.

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_102813.png)

Do seed lÃ  thá»i gian Ä‘Æ°á»£c láº¥y tá»« hÃ m `time()` vÃ  thá»i gian hiá»‡n táº¡i so vá»›i thá»i gian trÃªn server chÃªnh lá»‡ch nhau khÃ´ng quÃ¡ nhiá»u nÃªn mÃ¬nh cÃ³ thá»ƒ bruteforces Ä‘Æ°á»£c giÃ¡ trá»‹ cá»§a `seed` má»™t cÃ¡ch nhanh chÃ³ng.

```python
print(f"Here's 10 numbers for you: ")
for _ in range(10):
    print(w(5, 10000))
```

Äá»ƒ kiá»ƒm tra `seed` mÃ¬nh bruteforces Ä‘Æ°á»£c cÃ³ pháº£i lÃ  `seed` Ä‘Ã£ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ encrypt flag hay khÃ´ng cÅ©ng khÃ´ng cÃ³ gÃ¬ khÃ³. Äoáº¡n code trÃªn in ra cho mÃ¬nh 10 sá»‘ ngáº«u nhiÃªn, náº¿u cÃ¹ng má»™t `seed` thÃ¬ táº¥t nhiÃªn 10 sá»‘ sinh ngáº«u nhiÃªn cá»§a mÃ¬nh vÃ  10 sá»‘ nÃ y sáº½ pháº£i giá»‘ng nhau, mÃ¬nh chá»‰ cáº§n sinh ngáº«u nhiÃªn 10 sá»‘ rá»“i kiá»ƒm tra xem chÃºng cÃ³ giá»‘ng nhau hay khÃ´ng lÃ  Ä‘Æ°á»£c ğŸ˜œ.

ÄÃ¢y lÃ  solution cá»§a mÃ¬nh:

```python
from pwn import remote
from time import time
from random import seed, randint as w

start_time = int(time())

r = remote('challenge.rgbsec.xyz', 12345)
r.recvline()
arr = [ int(r.recvline()) for i in range(10) ]
cipher = int(r.recvline()[31:])
r.close()

end_time = int(time())

for t in range(start_time - 1000, end_time + 1000):
    seed(t)
    newarr = [ w(5, 10000) for _ in range(10) ]
    if newarr != arr:
        continue
    g = cipher.to_bytes((cipher.bit_length() + 7) // 8, 'little')
    b = bytearray([w(0, 255) for _ in range(40)])
    for i in range(len(g)):
        print(chr(g[i] ^ b[i]), end='')
    break

```


<a name="wu4"></a>

## {MISC} Picking Up The Pieces

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_105406.png)

BÃ i nÃ y há» yÃªu cáº§u tÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t giá»¯a nhÃ  vÃ  cá»­a hÃ ng. Coi báº£n Ä‘á»“ lÃ  má»™t Ä‘á»“ thá»‹ cÃ³ hÆ°á»›ng vÃ  Ä‘Æ°á»ng Ä‘i giá»¯a hai Ä‘á»‹a Ä‘iá»ƒm lÃ  hai chiá»u. Ãp dá»¥ng `Dijkstra` mÃ¬nh dá»… dÃ ng tÃ¬m Ä‘Æ°á»£c flag ğŸ´ cá»§a bÃ i nÃ y.

![] (../ctf/rgbCTF-2020/img/dijkstra.gif)

BÃ i nÃ y mÃ¬nh viáº¿t báº±ng `c++`. Äá»“ thá»‹ Ä‘Æ°á»£c biá»ƒu diá»…n báº±ng danh sÃ¡ch ká».
Gá»i `u` lÃ  `intersection 1`, `v` lÃ  `intersection 2`, `w` lÃ  `distance`, `s` lÃ  `string on the road`. Vá»›i má»—i con Ä‘Æ°á»ng mÃ¬nh táº¡o 2 cáº¡nh ngÆ°á»£c chiá»u nhau vá»›i cÃ¹ng má»™t trá»ng sá»‘ vÃ  chuá»—i s: 
`u -> v : (w, s)` vÃ  `v -> u : (w, s)`

```cpp
	freopen("map.txt", "r", stdin);
	for (int i = 1; i <= n; ++i) {
		int u, v, w;
		string s;
		cin >> u >> v >> w >> s;
		near[u].emplace_back(edge({v, w, s}));
		near[v].emplace_back(edge({u, w, s}));
	}
```

Sau Ä‘Ã³ Ã¡p dá»¥ng thuáº­t toÃ¡n `Dijkstra` Ä‘á»ƒ tÃ¬m Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t giá»¯a nhÃ  vÃ  cá»­a hÃ ng, má»—i khi cáº­p nháº­t Ä‘á»™ dÃ i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t cá»§a má»™t Ä‘á»‰nh thÃ¬ lÆ°u láº¡i truy váº¿t Ä‘á»ƒ xÃ­ ná»¯a truy váº¿t ngÆ°á»£c láº¡i tÃ¬m flag ğŸ´. MÃ¬nh káº¿t há»£p `Dijkstra` vá»›i `Binary Heap` Ä‘á»ƒ tá»‘i Æ°u vá» tá»‘c Ä‘á»™.

```cpp
	for (int i = 2; i <= n; ++i) // d[i] Ä‘á»™ dÃ i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« nhÃ  Ä‘áº¿n Ä‘á»‰nh i, ban Ä‘áº§u chÆ°a biáº¿t nÃªn mÃ¬nh Ä‘á»ƒ lÃ  má»™t sá»‘ ráº¥t lá»›n
		d[i] = 1e18;  // d[0] = 0 tá»©c Ä‘á»™ dÃ i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« nhÃ  vá» nhÃ  = 0, táº¥t nhiÃªn rá»“i :3
	heap.emplace(1);  
	while (!heap.empty()) {
		int u = heap.top();
		heap.pop();
		if (u == n)  // Khi Ä‘i tá»›i cá»­a hÃ ng thÃ¬ dá»«ng luÃ´n, khá»i bÃ n cÃ£i :v
			break;
		for (edge &t: near[u]) {
			int v = t.v, w = t.w;
			if (d[v] > d[u] + w) {  // Náº¿u Ä‘á»™ dÃ i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« 0 Ä‘áº¿n Ä‘á»‰nh u cá»™ng Ä‘á»™ dÃ i cáº¡nh (u, v) 
				d[v] = d[u] + w;	// ngáº¯n hÆ¡n Ä‘á»™ dÃ i Ä‘Æ°á»ng Ä‘i ngáº¯n nháº¥t tá»« 0 Ä‘áº¿n Ä‘á»‰nh v thÃ¬ cáº­p nháº­t d[v]
				heap.emplace(v);
				trace[v] = {u, t.s};  // GÃ¡n truy váº¿t cá»§a v báº±ng u kÃ¨m vá»›i chuá»—i s
			}
		}
	}
```

Source code: [map_sol.cpp](../ctf/rgbCTF-2020/map_sol.cpp)


<a name="wu5"></a>

## {MISC} [another witty algo challenge name]

[insert ez emoji]. BÃ i nÃ y lÃ  má»™t bÃ i Ä‘á»“ thá»‹ cÆ¡ báº£n, mÃ¬nh code chÆ°a Ä‘áº¿n 5' lÃ  xong ğŸ˜ˆ. 

![](../ctf/rgbCTF-2020/img/Screenshot_20200715_184517.png)

NgÆ°á»i ta cho 1 files `.txt` gá»“m má»™t báº£ng kÃ­ch thÆ°á»›c `5000 x 5000` bao gá»“m cÃ¡c sá»‘ 0 vÃ  1. YÃªu cáº§u tÃ¬m sá»‘ lÆ°á»£ng hÃ²n Ä‘áº£o trÃªn báº£ng. Táº­p há»£p cÃ¡c Ã´ chá»©a sá»‘ 1 náº±m ká» nhau Ä‘Æ°á»£c gá»i lÃ  Ä‘áº£o ğŸ‘ (cung la dao).

Coi báº£ng cÃ¡c Ã´ vuÃ´ng lÃ  má»™t Ä‘á»“ thá»‹, hai Ä‘á»‰nh cÃ³ cáº¡nh ná»‘i lÃ  hai Ã´ ká» nhau trong báº£ng. DÃ¹ng thuáº­t toÃ¡n `DFS` Ä‘á»ƒ Ä‘áº¿m sá»‘ lÆ°á»£ng thÃ nh pháº§n liÃªn thÃ´ng, Ä‘Ã¢y cÅ©ng chÃ­nh lÃ  flag ğŸ´ cáº§n tÃ¬m.

Source code: [grid_sol.cpp](../ctf/rgbCTF-2020/grid_sol.cpp)

## Háº¿t Ã²i, hong cÃ²n gÃ¬ ná»¯a Ä‘Ã¢u mÃ  kÃ©o :3 
